<!-- product-view.html
  Tinh gọn cho lab SSRF:
  - Nếu có ?url=..., trang CHỈ hiển thị ảnh (img src -> proxy /product/view?url=...)
  - Nếu không có url, hiển thị 1 thông báo nhỏ (không có input)
  - Không fetch/hiển thị HTML/text gì khác ở frontend
  - Backend phải có route /product/view để proxy ảnh (vulnerable SSRF)
-->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Image View — SSRF demo</title>

  <!-- Bootstrap (CSS only) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#07121a;
      --card: rgba(255,255,255,0.03);
      --muted: #cbd5e1;
    }
    html,body{height:100%}
    body{
      margin:0;
      background: linear-gradient(180deg,var(--bg), #021021);
      color: #eef6ff;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px;
    }
    .wrap{
      width:100%;
      max-width:1100px;
    }
    .card { background: var(--card); border: 1px solid rgba(255,255,255,0.04); border-radius: 10px; padding:14px; }
    .toolbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:12px; }
    .small-muted { color:var(--muted); font-size:0.92rem; }
    .img-wrap { display:flex; align-items:center; justify-content:center; min-height:64vh; }
    .img-wrap img { max-width:100%; max-height:80vh; border-radius:8px; box-shadow: 0 8px 30px rgba(2,6,23,0.7); }
    .notice { text-align:center; padding:56px 10px; color:var(--muted); }
    a.btn-back { text-decoration:none; color:#e6eef8; border:1px solid rgba(255,255,255,0.06); padding:6px 10px; border-radius:6px; background:transparent; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <!-- top bar: minimal -->
      <div class="toolbar">
        <div>
          <a class="btn-back" href="dashboard.html">← Back to Store</a>
        </div>
        <div class="small-muted">Product Image View — proxy via <code>/product/view?url=...</code></div>
      </div>

      <!-- result area: EITHER image (if url param) OR notice -->
      <div id="resultArea" class="img-wrap">
        <!-- content injected by JS below -->
      </div>
    </div>
  </div>

  <script>
    // LẤY query param 'url' (không có UI để nhập)
    function getQueryParam(name){
      return new URLSearchParams(window.location.search).get(name);
    }

    const resultArea = document.getElementById('resultArea');
    const url = getQueryParam('url');

    if (!url) {
      // KHÔNG hiển thị input — chỉ thông báo ngắn gọn
      resultArea.innerHTML = '<div class="notice">No image specified. Open this page with <code>?url=&lt;IMAGE_URL&gt;</code> to view the image via server proxy.</div>';
    } else {
      // Hiển thị CHỈ 1 thẻ <img> với src tới proxy endpoint
      // Lưu ý: proxy endpoint phải là /product/view?url=...
      const proxy = '/product/view?url=' + encodeURIComponent(url);
      const img = document.createElement('img');
      img.src = proxy;
      img.alt = 'Product image (proxied)';
      // nếu server trả không phải ảnh hoặc lỗi, show message thay vì text dump
      img.onerror = function(){
        resultArea.innerHTML = '<div class="notice" style="color:#ffb4b4">Không thể tải ảnh. Server có thể trả lỗi hoặc nội dung không phải là ảnh.</div>';
      };
      resultArea.appendChild(img);
    }
  </script>
</body>
</html>
